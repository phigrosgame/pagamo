// æŠ“å–ç•¶å‰é¡Œç›®çš„è³‡æ–™
function getQuestionData() {
    const div = document.querySelector('.question-iframe-container.pgo-style-question-content-wrapper-DprzUI');

    let questionText = '';
    let imgUrl = '';
    if (div) {
        questionText = div.innerHTML.replace(/<br>/g, '\n').replace(/<\/?[^>]+(>|$)/g, "").trim();
        console.log('é¡Œç›®æ–‡å­—:', questionText);

        const img = div.querySelector('img');
        if (img) {
            imgUrl = img.src;
            console.log('åœ–ç‰‡ç¶²å€:', imgUrl);
        }
    }

    const correctOptions = [];
    const correctDivs = document.querySelectorAll('div[data-correct="true"]');
    correctDivs.forEach(option => {
        const optionText = option.querySelector('.pgo-style-selection-content-1x0d36')?.textContent.trim();
        if (optionText) {
            correctOptions.push(optionText);
        }
    });

    console.log('æ­£ç¢ºé¸é …:', correctOptions);

    let existingData = JSON.parse(localStorage.getItem('quizData')) || [];

    const newResult = {
        question: {
            text: questionText,
            img: imgUrl || null
        },
        correctOptions: correctOptions.length > 0 ? correctOptions : null
    };

    // é˜²æ­¢é‡è¤‡
    const isDuplicate = existingData.some(item =>
        item.question.text === newResult.question.text &&
        JSON.stringify(item.correctOptions) === JSON.stringify(newResult.correctOptions)
    );

    if (!isDuplicate) {
        existingData.push(newResult);
        localStorage.setItem('quizData', JSON.stringify(existingData));
        console.log('âœ… æ–°è³‡æ–™å·²å„²å­˜ã€‚');
    } else {
        console.log('âš ï¸ è³‡æ–™é‡è¤‡ï¼Œæœªå„²å­˜ã€‚');
    }
}

// é»é¸ä¸‹ä¸€é¡Œçš„æŒ‰éˆ•
function goToNextQuestion(nextNumber) {
    const allButtons = document.querySelectorAll('.cursor_pointer.exam_control_list_sprite.q_btn > div');
    for (let btn of allButtons) {
        if (btn.textContent.trim() === String(nextNumber)) {
            btn.click();
            console.log(`â¡ï¸ é»äº†ç¬¬ ${nextNumber} é¡Œ`);
            return true;
        }
    }
    console.log(`âŒ æ²’æ‰¾åˆ°ç¬¬ ${nextNumber} é¡Œçš„æŒ‰éˆ•`);
    return false;
}

// ä¸»æµç¨‹
async function start() {
    // ç¬¬ä¸€æ¬¡ç›´æ¥æŠ“å–ç•¶å‰é é¢çš„è³‡æ–™ (ç¬¬ä¸€é¡Œ)
    console.log('ğŸ“¥ æŠ“å–ç¬¬ 1 é¡Œ');
    getQuestionData();

    // ç„¶å¾Œå¾ç¬¬ 2 é¡Œåˆ°ç¬¬ 20 é¡Œ
    let current = 2;
    const max = 20;

    while (current <= max) {
        await new Promise(resolve => setTimeout(resolve, 1500)); // ç­‰å¾…é é¢åˆ‡æ›
        goToNextQuestion(current);
        await new Promise(resolve => setTimeout(resolve, 1500)); // ç­‰å¾…é¡Œç›®è¼‰å…¥
        getQuestionData();
        current++;
    }

    console.log('ğŸ¯ å…¨éƒ¨é¡Œç›®æŠ“å–å®Œæˆï¼');
}

// é–‹å§‹
start();


